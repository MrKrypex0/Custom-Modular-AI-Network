name: Block Unauthorized Pushes to main

on:
  push:
    branches:
      - main

jobs:
  check-author:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Get git author
        id: get-author
        run: |
          # Get the author of the last commit
          AUTHOR=$(git log -1 --pretty=%an)
          echo "Author: $AUTHOR"
          echo "AUTHOR=$AUTHOR" >> $GITHUB_ENV

      - name: Fail if not repo owner
        if: env.AUTHOR != 'MrKrypex0'
        run: |
          echo "‚ùå ERROR: Only the repo owner is allowed to push directly to main."
          echo "Detected author: $AUTHOR"
          exit 1